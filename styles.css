/* ==========================================================================
   ATENEA DARK MODE - VERSIÓN FINAL COMPLETA
   Todos los fixes aplicados y funcionando
   ========================================================================== */

/* --- VARIABLES CSS --- */
:root {
    /* Backgrounds */
    --dm-bg-primary: #10141d;      /* Fondo principal */
    --dm-bg-secondary: #191f2a;    /* Recuadros y bloques */
    
    /* Borders */
    --dm-border: #2d3544;          /* Bordes principales */
    
    /* Text colors */
    --dm-text-primary: #eeeeee;    /* Texto principal */
    --dm-text-secondary: #a9b1bc;  /* Texto secundario */
    
    /* Accent colors */
    --dm-accent: #80D8FF;          /* Cian para links */
    --dm-accent-hover: #a0e8ff;    /* Hover state */
    
    /* Status colors */
    --dm-success: #4B9632;         /* Verde */
    --dm-error: #ff6b6b;           /* Rojo */
    --dm-warning: #ffd43b;         /* Amarillo */
    --dm-info: #74c0fc;            /* Azul info */
    
    /* Interactive states */
    --dm-hover: #2d3544;           /* Hover backgrounds */
}

/* ==========================================================================
   SECTION 1: BASE LAYOUT
   ========================================================================== */

body.dark-mode-enabled,
body.dark-mode-enabled html,
body.dark-mode-enabled #page,
body.dark-mode-enabled #page-wrapper,
body.dark-mode-enabled #region-main,
body.dark-mode-enabled .main-inner,
body.dark-mode-enabled header,
body.dark-mode-enabled #page-footer,
body.dark-mode-enabled .footer-section,
body.dark-mode-enabled .custom_footer_html,
body.dark-mode-enabled .filter-group,
body.dark-mode-enabled .bg-light,
body.dark-mode-enabled .bg-white,
body.dark-mode-enabled .backwhite,
body.dark-mode-enabled .login-container,
body.dark-mode-enabled .path-login #page,
body.dark-mode-enabled .path-login #page-wrapper,
body.dark-mode-enabled .card-header,
body.dark-mode-enabled .card-block,
body.dark-mode-enabled .login-campus,
body.dark-mode-enabled .userinitials {
    background-color: var(--dm-bg-primary) !important;
    color: var(--dm-text-primary) !important;
    background-image: none !important;
    border: none !important;
    box-shadow: none !important;
}

/* ==========================================================================
   SECTION 2: CARDS & BLOCKS
   ========================================================================== */

body.dark-mode-enabled nav.navbar,
body.dark-mode-enabled .card,
body.dark-mode-enabled .card-body,
body.dark-mode-enabled .card-footer,
body.dark-mode-enabled .card-text,
body.dark-mode-enabled .block,
body.dark-mode-enabled .drawer,
body.dark-mode-enabled .modal-content,
body.dark-mode-enabled .dropdown-menu,
body.dark-mode-enabled .popover,
body.dark-mode-enabled .popover-body,
body.dark-mode-enabled .activity-item,
body.dark-mode-enabled .list-group-item,
body.dark-mode-enabled footer,
body.dark-mode-enabled .logininfo,
body.dark-mode-enabled .form-autocomplete-selection,
body.dark-mode-enabled .form-autocomplete-input,
body.dark-mode-enabled .form-autocomplete-suggestions,
body.dark-mode-enabled div[role="menubar"],
body.dark-mode-enabled .moremenu,
body.dark-mode-enabled .navigation,
body.dark-mode-enabled .nav-tabs,
body.dark-mode-enabled .activity-header,
body.dark-mode-enabled .filter-group div[data-filterregion="actions"],
body.dark-mode-enabled .message-app,
body.dark-mode-enabled .message-app div,
body.dark-mode-enabled .view-conversation,
body.dark-mode-enabled .body-container,
body.dark-mode-enabled .conversationcontainer,
body.dark-mode-enabled .panel-header-container,
body.dark-mode-enabled .footer-container,
body.dark-mode-enabled .view-overview-body,
body.dark-mode-enabled .view-search,
body.dark-mode-enabled .icons-collapse-expand,
body.dark-mode-enabled [data-for="sectiontoggler"],
body.dark-mode-enabled [data-toggler="drawers"],
body.dark-mode-enabled .border-radius.bg-white.border.d-flex,
body.dark-mode-enabled .filter-group.bg-light.border-radius,
body.dark-mode-enabled .badge.bg-secondary.text-dark,
body.dark-mode-enabled .cell,
body.dark-mode-enabled [id^="firstinitial_page-item_"],
body.dark-mode-enabled [id^="lastinitial_page-item_"],
body.dark-mode-enabled .page-link:not(.active):not(.disabled),
body.dark-mode-enabled .user-report-container,
body.dark-mode-enabled thead th.header,
body.dark-mode-enabled th.header.column-itemname,
body.dark-mode-enabled .info,
body.dark-mode-enabled .outcome.clearfix {
    background-color: var(--dm-bg-secondary) !important;
    border-color: var(--dm-border) !important;
}

/* ==========================================================================
   SECTION 3: TYPOGRAPHY
   ========================================================================== */

/* Cyan text for links and important elements */
body.dark-mode-enabled .header a,
body.dark-mode-enabled .header strong,
body.dark-mode-enabled .cell,
body.dark-mode-enabled .cell a,
body.dark-mode-enabled .cell strong,
body.dark-mode-enabled .cell span,
body.dark-mode-enabled .page-link:not(.active):not(.disabled),
body.dark-mode-enabled .btn.dropdown-toggle,
body.dark-mode-enabled .dropdown-item,
body.dark-mode-enabled .dropdown-menu li[role="presentation"],
body.dark-mode-enabled .select-menu .dropdown-toggle,
body.dark-mode-enabled pre,
body.dark-mode-enabled code,
body.dark-mode-enabled th pre,
body.dark-mode-enabled td pre,
body.dark-mode-enabled footer a,
body.dark-mode-enabled .footer-section a,
body.dark-mode-enabled .custom_footer_html a,
body.dark-mode-enabled a[href*="atenea-accessibilitat"],
body.dark-mode-enabled a[href*="avis-legal"],
body.dark-mode-enabled a[href*="politica-cookies"],
body.dark-mode-enabled a[href*="upc.edu"],
body.dark-mode-enabled th.header,
body.dark-mode-enabled th.header.column-itemname,
body.dark-mode-enabled th.header.c0,
body.dark-mode-enabled th.header.c1,
body.dark-mode-enabled th.header.c2,
body.dark-mode-enabled th.header.c3,
body.dark-mode-enabled th.header.c4,
body.dark-mode-enabled th.header.c5,
body.dark-mode-enabled [id^="form_autocomplete_selection-"],
body.dark-mode-enabled [role="option"],
body.dark-mode-enabled .badge.bg-secondary.text-dark.clickable,
body.dark-mode-enabled h3,
body.dark-mode-enabled h3 a,
body.dark-mode-enabled h4,
body.dark-mode-enabled h4 a,
body.dark-mode-enabled .sectionname a,
body.dark-mode-enabled i.icon,
body.dark-mode-enabled i.fa,
body.dark-mode-enabled .fa {
    color: var(--dm-accent) !important;
}

/* White text for headings and labels */
body.dark-mode-enabled h1,
body.dark-mode-enabled h2,
body.dark-mode-enabled h5,
body.dark-mode-enabled .logininfo,
body.dark-mode-enabled label,
body.dark-mode-enabled legend,
body.dark-mode-enabled strong,
body.dark-mode-enabled p,
body.dark-mode-enabled span,
body.dark-mode-enabled time,
body.dark-mode-enabled .mb-1.line-height-3.text-truncate {
    color: var(--dm-text-primary) !important;
}

/* Secondary text color */
body.dark-mode-enabled .badge.rounded-pill.bg-secondary.text-dark.order-3:not(.clickable) {
    color: var(--dm-text-secondary) !important;
}

/* Success text (right answer in quizzes) */
body.dark-mode-enabled .rightanswer {
    color: var(--dm-success) !important;
}

/* ==========================================================================
   SECTION 4: INTERACTIVE ELEMENTS
   ========================================================================== */

/* Buttons and form controls */
body.dark-mode-enabled button.btn:not(.btn-link):not([data-toggler="drawers"]),
body.dark-mode-enabled .btn-secondary,
body.dark-mode-enabled .custom-select,
body.dark-mode-enabled .form-control,
body.dark-mode-enabled input[type="text"],
body.dark-mode-enabled input[type="password"],
body.dark-mode-enabled textarea {
    background-color: var(--dm-bg-secondary) !important;
    color: var(--dm-text-primary) !important;
    border: 1px solid var(--dm-border) !important;
    border-radius: 8px !important;
}

/* Remove filter delete button border */
body.dark-mode-enabled [aria-label="Suprimeix la fila de filtres"] {
    border: none !important;
    background: transparent !important;
    box-shadow: none !important;
}

/* ==========================================================================
   SECTION 5: NAVIGATION
   ========================================================================== */

/* Active nav links */
body.dark-mode-enabled .secondary-navigation .nav-tabs .nav-link.active,
body.dark-mode-enabled .moremenu .nav-link.active,
body.dark-mode-enabled #page-header .nav-link.active,
body.dark-mode-enabled a[role="menuitem"].active {
    background-color: var(--dm-bg-secondary) !important;
    color: var(--dm-text-primary) !important;
    border: none !important;
    border-bottom: 2px solid var(--dm-accent) !important;
    box-shadow: none !important;
}

/* Hover on inactive nav links */
body.dark-mode-enabled .secondary-navigation .nav-link:not(.active):hover,
body.dark-mode-enabled .moremenu .nav-link:not(.active):hover,
body.dark-mode-enabled #page-header .nav-link:not(.active):hover {
    background-color: var(--dm-hover) !important;
    color: var(--dm-text-primary) !important;
    border-radius: 8px !important;
    transition: background-color 0.2s ease !important;
}

/* Prevent color change on active nav links */
body.dark-mode-enabled .secondary-navigation .nav-link.active:hover,
body.dark-mode-enabled .secondary-navigation .nav-link.active:focus,
body.dark-mode-enabled .secondary-navigation .nav-link.active:active,
body.dark-mode-enabled .moremenu .nav-link.active:hover,
body.dark-mode-enabled .moremenu .nav-link.active:focus,
body.dark-mode-enabled .moremenu .nav-link.active:active,
body.dark-mode-enabled .specificfeedback {
    background-color: var(--dm-bg-secondary) !important;
    color: var(--dm-text-primary) !important;
    border: none !important;
    box-shadow: none !important;
    outline: none !important;
}

/* Fix: Eliminate transitions that cause flash on click */
body.dark-mode-enabled .nav-link,
body.dark-mode-enabled .nav-link *,
body.dark-mode-enabled a[role="tab"],
body.dark-mode-enabled a[role="tab"] * {
    transition: none !important;
}

/* aunclick navigation */
body.dark-mode-enabled ul.aunclick li a {
    color: var(--dm-accent) !important;
    background-color: var(--dm-bg-secondary) !important;
    box-shadow: inset 0 0 0 1px #d1d1d1 !important;
    border: none !important;
    border-radius: 50px !important;
    padding: 6px 16px !important;
    transition: all 0.1s ease-in-out !important;
    display: inline-block !important;
}

body.dark-mode-enabled ul.aunclick li a:hover {
    background-color: var(--dm-hover) !important;
    box-shadow: inset 0 0 0 1px #ffffff !important;
    color: #ffffff !important;
}

/* ==========================================================================
   SECTION 6: BORDERS & CONTAINERS
   ========================================================================== */

body.dark-mode-enabled .message-app,
body.dark-mode-enabled .row.h-100.g-0,
body.dark-mode-enabled .filter-group,
body.dark-mode-enabled [id^="moremenu-"][id$="-nav-tabs"],
body.dark-mode-enabled .login-container,
body.dark-mode-enabled .login-container .card,
body.dark-mode-enabled .filter-group.my-2.p-2,
body.dark-mode-enabled .border-radius.bg-white.border.d-flex,
body.dark-mode-enabled [id^="firstinitial_page-item_"],
body.dark-mode-enabled [id^="lastinitial_page-item_"],
body.dark-mode-enabled .page-link,
body.dark-mode-enabled .user-report-container {
    border: 1px solid var(--dm-border) !important;
    border-radius: 8px !important;
    overflow: hidden !important;
}

/* Participants table and quiz tables */
body.dark-mode-enabled #participants,
body.dark-mode-enabled .table-responsive,
body.dark-mode-enabled .generaltable.generalbox.quizreviewsummary.mb-0,
body.dark-mode-enabled .table.discussion-list.generaltable {
    border: 1px solid var(--dm-border) !important;
    border-radius: 8px !important;
    border-collapse: separate !important;
    overflow: hidden !important;
}

/* ==========================================================================
   SECTION 7: SECTION-ITEM (Actividades individuales)
   ========================================================================== */

body.dark-mode-enabled div.section-item,
body.dark-mode-enabled div.section-item:focus,
body.dark-mode-enabled div.section-item:active,
body.dark-mode-enabled div.section-item:focus-within,
body.dark-mode-enabled div.section-item[id^="yui_3_18"] {
    background-color: var(--dm-bg-secondary) !important;
    border: 1px solid var(--dm-border) !important;
    border-radius: 15px !important;
    overflow: hidden !important;
    outline: none !important;
    box-shadow: none !important;
    position: relative !important;
    isolation: isolate !important;
}

body.dark-mode-enabled .section-item .course-section-header,
body.dark-mode-enabled .section-item .content.course-content-item-content {
    background-color: transparent !important;
    background-image: none !important;
    border-radius: 0 !important;
    border: none !important;
}

body.dark-mode-enabled .section-item * {
    background-clip: padding-box !important;
}

/* ==========================================================================
   SECTION 8: SECCIONES NUMERADAS (section-1, section-2, etc.) - FIX CRÍTICO
   ========================================================================== */

body.dark-mode-enabled li.section,
body.dark-mode-enabled li[id^="section-"],
body.dark-mode-enabled #section-1,
body.dark-mode-enabled #section-2,
body.dark-mode-enabled #section-3,
body.dark-mode-enabled #section-4,
body.dark-mode-enabled #section-5,
body.dark-mode-enabled #section-6,
body.dark-mode-enabled #section-7,
body.dark-mode-enabled #section-8,
body.dark-mode-enabled #section-9,
body.dark-mode-enabled #section-10,
body.dark-mode-enabled #section-11,
body.dark-mode-enabled #section-12,
body.dark-mode-enabled #section-13,
body.dark-mode-enabled #section-14,
body.dark-mode-enabled #section-15,
body.dark-mode-enabled li.section.main {
    background-color: var(--dm-bg-secondary) !important;
    border: 1px solid var(--dm-border) !important;
    border-radius: 15px !important;
    overflow: hidden !important;
    padding: 0 !important;
    margin-bottom: 20px !important;
}

/* CRÍTICO: El section-item HIJO no debe tener borde (evita duplicación) */
body.dark-mode-enabled li.section .section-item,
body.dark-mode-enabled li.section > .section-item {
    border: none !important;
    border-radius: 0 !important;
    background-color: transparent !important;
}

/* Los demás hijos transparentes */
body.dark-mode-enabled li.section > *:not(.section-item),
body.dark-mode-enabled li.section .content,
body.dark-mode-enabled li.section .sectionhead {
    background-color: transparent !important;
    background-image: none !important;
    border: none !important;
}

/* El UL interno (lista de actividades) sin background ni borde */
body.dark-mode-enabled li.section ul.section,
body.dark-mode-enabled li.section > ul {
    background: transparent !important;
    border: none !important;
    padding: 10px !important;
}

/* ==========================================================================
   SECTION 9: TRANSPARENT ELEMENTS
   ========================================================================== */

body.dark-mode-enabled .footer-content-popover,
body.dark-mode-enabled .moremenu.navigation.observed,
body.dark-mode-enabled .announcement_info,
body.dark-mode-enabled .container-fluid,
body.dark-mode-enabled .overviews.list-group,
body.dark-mode-enabled .overviews.list-group .list-group-item,
body.dark-mode-enabled .cattree,
body.dark-mode-enabled .border-bottom,
body.dark-mode-enabled .border-end,
body.dark-mode-enabled .border-top,
body.dark-mode-enabled .border-0,
body.dark-mode-enabled #maincontent,
body.dark-mode-enabled div[id^="yui_3_18_1_1_"],
body.dark-mode-enabled div[id^="message-index-"],
body.dark-mode-enabled .message-app a[role="button"],
body.dark-mode-enabled .message-app .btn-link,
body.dark-mode-enabled .secondary-navigation,
body.dark-mode-enabled .backwhite.flexwrap,
body.dark-mode-enabled fieldset,
body.dark-mode-enabled [data-filterregion="filter"],
body.dark-mode-enabled thead th.header,
body.dark-mode-enabled .formulation.clearfix {
    background-color: transparent !important;
    border: none !important;
    box-shadow: none !important;
}

/* ==========================================================================
   SECTION 10: COURSE CARDS
   ========================================================================== */

body.dark-mode-enabled .card.dashboard-card,
body.dark-mode-enabled .card.coursebox,
body.dark-mode-enabled .card[id^="course-info-container-"] {
    background-color: var(--dm-bg-secondary) !important;
    border: 1px solid var(--dm-border) !important;
    border-radius: 8px !important;
    overflow: hidden !important;
}

body.dark-mode-enabled .course-info-container,
body.dark-mode-enabled div[id^="yui_3_18"].course-info-container,
body.dark-mode-enabled .card-body.course-info-container {
    border: none !important;
    background-color: transparent !important;
    box-shadow: none !important;
}

body.dark-mode-enabled div[id^="yui_3_18"].card,
body.dark-mode-enabled div[id^="yui_3_18"].dashboard-card {
    background-color: var(--dm-bg-secondary) !important;
    border: 1px solid var(--dm-border) !important;
}

body.dark-mode-enabled .course-info-container .mycourses_detailinfo ul.overviews {
    background-color: transparent !important;
    border: none !important;
}

body.dark-mode-enabled .course-info-container li.list-group-item.cattree {
    background-color: transparent !important;
    border: none !important;
    color: var(--dm-text-secondary) !important;
}

/* ==========================================================================
   SECTION 11: DASHBOARD BLOCKS
   ========================================================================== */

body.dark-mode-enabled section.block.card,
body.dark-mode-enabled .block_announcements.card,
body.dark-mode-enabled .block_timeline.card {
    background-color: var(--dm-bg-secondary) !important;
    border: 1px solid var(--dm-border) !important;
    border-radius: 12px !important;
    overflow: hidden !important;
}

body.dark-mode-enabled section.block .card-body,
body.dark-mode-enabled section.block .backwhite,
body.dark-mode-enabled section.block .list-group-item,
body.dark-mode-enabled section.block .announcement_element_box,
body.dark-mode-enabled section.block .p-0.px-2 {
    background-color: transparent !important;
    border: none !important;
}

body.dark-mode-enabled section.block .card-text,
body.dark-mode-enabled section.block .content,
body.dark-mode-enabled section.block .announcement_info {
    background-color: transparent !important;
    box-shadow: none !important;
}

body.dark-mode-enabled section.block div[id^="yui_3_18"] {
    background-color: transparent !important;
    border: none !important;
}

body.dark-mode-enabled section.block h3,
body.dark-mode-enabled section.block h4,
body.dark-mode-enabled section.block h5,
body.dark-mode-enabled section.block .event-name a {
    color: var(--dm-accent) !important;
}

body.dark-mode-enabled section.block p,
body.dark-mode-enabled section.block span,
body.dark-mode-enabled section.block small {
    color: var(--dm-text-primary) !important;
}

/* ==========================================================================
   SECTION 12: BADGES
   ========================================================================== */

body.dark-mode-enabled .badge.rounded-pill.alert-success.icon-no-margin {
    background-color: var(--dm-success) !important;
    color: #ffffff !important;
    border: none !important;
}

/* ==========================================================================
   SECTION 13: ICONS
   ========================================================================== */

body.dark-mode-enabled img.icon,
body.dark-mode-enabled .activityicon {
    filter: invert(1) hue-rotate(180deg);
}

body.dark-mode-enabled .img-footer,
body.dark-mode-enabled img[src*="footer"] {
    filter: invert(0.9) hue-rotate(180deg) !important;
}

/* ==========================================================================
   SECTION 14: ACTIVITY INFORMATION
   ========================================================================== */

body.dark-mode-enabled .activity-header[id^="yui_3_18"] {
    background-color: var(--dm-bg-secondary) !important;
    border-radius: 0.5rem !important;
    padding: 0 1.25rem !important;
}

body.dark-mode-enabled .activity-information[id^="yui_3_18"],
body.dark-mode-enabled .activity-information[id^="yui_3_18"] .completion-info,
body.dark-mode-enabled .activity-information[id^="yui_3_18"] .activity-dates {
    background-color: transparent !important;
    border-left: none !important;
    border-right: none !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
}

body.dark-mode-enabled .activity-information[id^="yui_3_18"] .completion-info {
    border-bottom: 1px solid #dee2e6 !important;
    padding-top: 1rem !important;
    padding-bottom: 1rem !important;
}

body.dark-mode-enabled .activity-information[id^="yui_3_18"] .activity-dates {
    border-top: none !important;
    padding-top: 1rem !important;
    padding-bottom: 1rem !important;
}

body.dark-mode-enabled .activity-information[id^="yui_3_18"] strong,
body.dark-mode-enabled .activity-information[id^="yui_3_18"] span:not(.badge) {
    color: var(--dm-text-primary) !important;
}

/* ==========================================================================
   SECTION 15: QUIZ INFO BLOCKS
   ========================================================================== */

/* Maximum priority fix for quiz question info blocks */
html body.dark-mode-enabled .que .info,
html body.dark-mode-enabled div.info,
html body.dark-mode-enabled .que .info[id*="yui"],
html body.dark-mode-enabled div.info[id*="yui"] {
    background-color: var(--dm-bg-secondary) !important;
    border: 1px solid var(--dm-border) !important;
    border-radius: 8px !important;
    color: var(--dm-text-primary) !important;
    display: block !important;
}

/* Internal text protection */
html body.dark-mode-enabled .que .info .no,
html body.dark-mode-enabled .que .info .state,
html body.dark-mode-enabled .que .info .qno {
    background-color: transparent !important;
    border: none !important;
}

html body.dark-mode-enabled .que .info .qno {
    color: var(--dm-accent) !important;
    font-weight: bold !important;
}

/* Force YUI children to be transparent */
html body.dark-mode-enabled .info div[id*="yui"] {
    background-color: transparent !important;
    border: none !important;
}

/* ==========================================================================
   SECTION 16: LOGO
   ========================================================================== */

body.dark-mode-enabled .navbar-brand {
    background-image: url('chrome-extension://__MSG_@@extension_id__/logo-upc.png') !important;
    background-repeat: no-repeat;
    background-position: center left;
    background-size: contain;
    width: 200px;
    height: 50px;
}

body.dark-mode-enabled .navbar-brand img {
    opacity: 0 !important;
}

/* ==========================================================================
   SECTION 17: SCROLLBAR
   ========================================================================== */

body.dark-mode-enabled ::-webkit-scrollbar {
    width: 12px;
    background-color: var(--dm-bg-primary);
}

body.dark-mode-enabled ::-webkit-scrollbar-thumb {
    background-color: var(--dm-hover);
    border-radius: 10px;
    border: 3px solid var(--dm-bg-primary);
}

body.dark-mode-enabled ::-webkit-scrollbar-thumb:hover {
    background-color: var(--dm-accent);
}

/* ==========================================================================
   SECTION 18: DARK MODE SWITCH (UI ONLY - NOT CONDITIONED)
   ========================================================================== */

#atenea-dark-mode-container {
    display: flex;
    align-items: center;
    height: 100%;
}

body.dark-mode-enabled li {
    background-color: transparent !important;
}